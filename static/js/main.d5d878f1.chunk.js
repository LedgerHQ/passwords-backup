(this["webpackJsonppasswords-backup"]=this["webpackJsonppasswords-backup"]||[]).push([[0],{151:function(e,t,n){},153:function(e,t,n){},154:function(e,t,n){"use strict";n.r(t);var s=n(1),r=n(0),a=n.n(r),o=n(12),c=n.n(o),i=(n(68),n(8)),u=n(2),l=n.n(u),h=n(3),d=n.p+"static/media/logo.aeffe6a7.svg";n(70);var p=function(e){var t=e.text,n=e.color,a=e.disabled,o=e.hidden,c=e.onClick,u=Object(r.useState)(!1),l=Object(i.a)(u,2),h=l[0],d=l[1],p=Object(r.useRef)(null),b=function(){p.current.value.length||d(!1),document.body.onfocus=null},f=Object(r.useCallback)((function(){d(!0),document.body.onfocus=b,p.current&&p.current.click()}),[]),j=Object(r.useCallback)((function(e){e.target.files[0].text().then((function(t){e.target.value="",c(t).then((function(){return d(!1)}))}))}),[c]);return Object(s.jsxs)("button",{className:"RestoreButton",disabled:h|a,onClick:h?null:f,style:{margin:"10px",backgroundColor:n,display:!o||"none"},children:[h?"Loading\u2026":t,Object(s.jsx)("input",{type:"file",ref:p,onChange:j,accept:".json",style:{display:"none"}})]})};n(71);var b=function(e){var t=e.text,n=e.color,a=e.disabled,o=e.hidden,c=e.onClick,u=Object(r.useState)(!1),l=Object(i.a)(u,2),h=l[0],d=l[1],p=Object(r.useCallback)((function(){d(!0),c().then((function(e){e&&function(e){var t=new Blob([JSON.stringify(e,null,4)],{type:"application/json;charset=utf-8"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download="backup.json",document.body.appendChild(s),s.click(),document.body.removeChild(s)}(e),d(!1)}))}),[c]);return Object(s.jsx)("button",{className:"BackupButton",disabled:h|a,onClick:h?null:p,style:{margin:"10px",backgroundColor:n,display:!o||"none"},children:h?"Loading\u2026":t})},f=n(55),j=n(4),v=n(20),m=n.n(v);n(151);function w(){var e=Object(r.useState)([]),t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(s.jsxs)(j.a,{allowZeroExpanded:!0,allowMultipleExpanded:!0,onChange:function(e){if(e.length>n.length){var t=e[e.length-1],s=document.getElementById("accordion__panel-".concat(t)).getBoundingClientRect().bottom;s>window.innerHeight&&window.scrollBy(0,s-window.innerHeight)}a(e)},children:[Object(s.jsxs)(j.b,{children:[Object(s.jsx)(j.d,{children:Object(s.jsx)(j.c,{children:"What is this Web App ?"})}),Object(s.jsx)(j.e,{children:Object(s.jsx)(m.a,{className:"Explanations",children:"This Web App allows you to backup/restore the list of `password nicknames` stored inside the `Passwords app` on your Ledger Nano S/ Nano X.  \n    It is useful to have such a backup when you update the Passwords app on your device, or the device firmware, because the list gets erased. Another case where it's practical to have a nickname backup is when you loose your device: Restoring the [24-words recovery phrase](https://www.ledger.com/academy/crypto/what-is-a-recovery-phrase) is necessary but not sufficient to restore your passwords, you need your nickname list as well.  \n    The backup consists in a human readable `backup.json` file containing a dump of the 4096 bytes of application storage."})})]}),Object(s.jsxs)(j.b,{children:[Object(s.jsx)(j.d,{children:Object(s.jsx)(j.c,{children:"What is the Ledger Passwords application ?"})}),Object(s.jsx)(j.e,{children:Object(s.jsx)(m.a,{className:"Explanations",children:"Look [here](https://github.com/LedgerHQ/app-passwords/blob/master/README.md) for more information on the device application itself."})})]}),Object(s.jsxs)(j.b,{children:[Object(s.jsx)(j.d,{children:Object(s.jsx)(j.c,{children:"How to use this Web App ?"})}),Object(s.jsx)(j.e,{children:Object(s.jsx)(m.a,{className:"Explanations",children:'* Connect your Nano S/X to your computer and open the `Passwords app`.\n* You can now click on the big `Connect` button, and if it succeeds the `Backup` and `Restore` buttons should replace the previous button. If you have troubles with this step, have a look [here](https://support.ledger.com/hc/en-us/articles/115005165269-Fix-connection-issues). \n* Either click on `Backup` or `Restore` depending on what you want to do:  \n    * `Backup` will prompt a screen requesting your approval on your device (`"Transfer metadatas ?"`), then save a backup file. This is your backup. it\'s not confidential, so for instance you can send it to yourself by e-mail to never loose it.  \n    * `Restore` will prompt a file input dialog where you should indicate a previous backup file. A prompt (`"Overwite metadatas ?"`) will then request your approval on your device. Done.'})})]}),Object(s.jsxs)(j.b,{children:[Object(s.jsx)(j.d,{children:Object(s.jsx)(j.c,{children:"Which web browsers are supported ?"})}),Object(s.jsx)(j.e,{children:Object(s.jsx)(m.a,{className:"Explanations",children:"The communication with the device is done through `WebUSB`, which is curently supported only on `Google Chrome` / `Chromium` / `Brave` for `Linux` and `MacOS`. On `Windows`, [Zadig](https://github.com/WICG/webusb/issues/143) is required."})})]}),Object(s.jsxs)(j.b,{children:[Object(s.jsx)(j.d,{children:Object(s.jsx)(j.c,{children:"Less common use cases"})}),Object(s.jsx)(j.e,{children:Object(s.jsx)(m.a,{className:"Explanations",children:"* If you ever encounter a WTF-kind of error with your passwords app (some or all of your entries are suddenly gone? A password has changed ?), it is wise to first come here and make a backup. You can then have a look inside the backup file to see if something is wrong (You might also want to create an issue [here](https://github.com/LedgerHQ/app-passwords/issues) so we fix your issue for all users). \n* If you want to add a lot of new passwords, the manual input on the device keyboard will show its limits. You can instead create a backup and edit it manually to add all your new entries. You just have to restore your app with this file and the job is done :)"})})]})]})}var g=n(13),k=(n(152),n(21)),O=n(60),x=(n(153),new f.a);Object(k.a)((function(e){console.log(e)}));var y=function(){function e(e,t){return new Promise(function(){var n=Object(h.a)(l.a.mark((function n(s){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=null,n.prev=1,e.connected){n.next=7;break}return n.next=5,e.connect();case 5:j(!0),g.b.info("Device connected \ud83d\udc4c",{autoClose:!1});case 7:if(!t){n.next=15;break}return g.b.info("Approve action on your device \u2728",{autoClose:!1}),o(!0),n.next=12,t();case 12:r=n.sent,g.b.dismiss(),g.b.success("Success \ud83e\udd84");case 15:n.next=23;break;case 17:n.prev=17,n.t0=n.catch(1),e.disconnect(),j(!1),g.b.dismiss(),g.b.error("".concat(n.t0.toString()," \ud83d\ude45"));case 23:return n.prev=23,o(!1),s(r),n.finish(23);case 27:case"end":return n.stop()}}),n,null,[[1,17,23,27]])})));return function(e){return n.apply(this,arguments)}}())}var t=Object(r.useState)(!1),n=Object(i.a)(t,2),a=n[0],o=n[1],c=Object(r.useState)(!1),u=Object(i.a)(c,2),f=u[0],j=u[1];return Object(s.jsxs)("div",{className:"App",children:[Object(s.jsx)(g.a,{hideProgressBar:!0}),Object(s.jsxs)("div",{className:"App-banner",children:[Object(s.jsx)("img",{src:d,className:"App-logo",alt:"logo"}),Object(s.jsx)("p",{className:"App-title",children:"Passwords Backup"})]}),Object(s.jsxs)("header",{className:"App-header",children:[Object(s.jsxs)("div",{className:"Commands",children:[Object(s.jsx)(b,{text:"Connect",color:"#41ccb4",disabled:a,hidden:f,onClick:function(){return e(x)}}),Object(s.jsx)(b,{text:"Backup",color:"#41ccb4",disabled:a,hidden:!f,onClick:function(){return e(x,(function(){return x.dump_metadatas()}))}}),Object(s.jsx)(p,{text:"Restore",color:"#FFB86D",disabled:a,hidden:!f,onClick:function(t){return e(x,(function(){return x.load_metadatas(t)}))}})]}),Object(s.jsx)(w,{}),Object(s.jsx)("div",{className:"App-footer",children:Object(s.jsxs)("p",{children:["A modest Web App built at Ledger with React, hosted by Github. v","".concat(O.version),"."," ",Object(s.jsx)("a",{href:"https://github.com/LedgerHQ/passwords-backup",children:"PRs welcomed and appreciated \u2728"})]})})]})]})};c.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(y,{})}),document.getElementById("root"))},55:function(e,t,n){"use strict";(function(e){var s=n(30),r=n(2),a=n.n(r),o=n(8),c=n(3),i=n(16),u=n(17),l=n(56),h=Object.freeze({GET_APP_INFO_COMMAND:1,GET_APP_CONFIG_COMMAND:3,DUMP_METADATAS_COMMAND:4,LOAD_METADATAS_COMMAND:5}),d=Object.freeze({UPPERCASE:1,LOWERCASE:2,NUMBERS:4,MINUS:8,UNDERLINE:16,SPACE:32,SPECIAL:64,BRACKETS:128}),p=function(){function t(){Object(i.a)(this,t),this.allowedStatuses=[36864,27013,27270,27271,27904,28160,45056],this.connected=!1,this.busy=!1,this.transport=null}return Object(u.a)(t,[{key:"connect",value:function(){var e=Object(c.a)(a.a.mark((function e(){var t,n,s,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=28;break}if(this.transport){e.next=5;break}return e.next=4,l.a.create();case 4:this.transport=e.sent;case 5:return e.prev=5,e.next=8,this.getAppInfo();case 8:if(t=e.sent,n=Object(o.a)(t,2),s=n[0],r=n[1],"Passwords"===s.toString()){e.next=14;break}throw new Error("The Passwords app is not opened on the device");case 14:return this.version=r,e.next=17,this.getAppConfig();case 17:c=e.sent,this.storage_size=c.storage_size,this.connected=!0,e.next=28;break;case 22:return e.prev=22,e.t0=e.catch(5),e.next=26,this.transport.close();case 26:throw this.disconnect(),e.t0;case 28:case"end":return e.stop()}}),e,this,[[5,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"isSuccess",value:function(e){return e.length>=2&&36864===e.readUInt16BE(e.length-2)}},{key:"disconnect",value:function(){this.connected=!1,this.transport=null}},{key:"mapProtocolError",value:function(e){if(e.length<2)throw new Error("Response length is too small");var t={27013:"Action cancelled",27270:"SW_WRONG_P1P2",27271:"SW_WRONG_DATA_LENGTH",27904:"SW_INS_NOT_SUPPORTED",28160:"SW_CLA_NOT_SUPPORTED",45056:"SW_APPNAME_TOO_LONG",28432:"SW_METADATAS_PARSING_ERROR"},n=e.readUInt16BE(e.length-2);if(n in t)throw new Error(t[n])}},{key:"_lock",value:function(){if(this.busy)throw new Error("Device is busy");this.busy=!0}},{key:"_unlock",value:function(){this.busy=!1}},{key:"_charsetListToBitmask",value:function(e){var t,n=0,r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n|=d[a]}}catch(o){r.e(o)}finally{r.f()}return 0===n&&(n=255),n}},{key:"_bitmaskToCharsetList",value:function(e){var t=[];if(0===e||255===e)t.push("ALL_SETS");else for(var n in d)d[n]&e&&t.push(n);return t}},{key:"_toBytes",value:function(t){var n=this,s=e.alloc(this.storage_size),r=JSON.parse(t).parsed,a=0;return r.forEach((function(e){var t=e.nickname,r=n._charsetListToBitmask(e.charsets);if(t.length>19)throw new Error("Nickname too long (19 max): ".concat(t," has length ").concat(t.length));if(a+3+t.length>=n.storage_size)throw new Error("Not enough memory on this device to restore this backup");s[a++]=t.length+1,s[a++]=0,s[a++]=r,s.write(t,a),a+=t.length})),s[a++]=0,s[a++]=0,s}},{key:"_toJSON",value:function(e){for(var t=[],n=[],s=0,r=[];;){var a=e[s];if(0===a)break;var o=255===e[s+1],c=e[s+2];a>20&&(r+=[s,"nickname too long ".concat(a,", max is 19")]);var i={nickname:e.slice(s+3,s+2+a).toString(),charsets:this._bitmaskToCharsetList(c)};o?n.push(i):t.push(i),s+=a+2}return{parsed:t,nicknames_erased_but_still_stored:n,corruptions_encountered:r,raw_metadatas:e.toString("hex")}}},{key:"_load_metadatas_chunk",value:function(){var t=Object(c.a)(a.a.mark((function t(n,s){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.transport.send(224,h.LOAD_METADATAS_COMMAND,s?255:0,0,e.from(n),this.allowedStatuses);case 2:return r=t.sent,this.isSuccess(r)||this.mapProtocolError(r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAppInfo",value:function(){var t=Object(c.a)(a.a.mark((function t(){var n,s,r,o,c,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._lock(),t.prev=1,t.next=4,this.transport.send(176,h.GET_APP_INFO_COMMAND,0,0,e(0),this.allowedStatuses);case 4:return n=t.sent,this.isSuccess(n)||this.mapProtocolError(n),n=n.slice(0,n.length-2),t.prev=7,o=1,c=n[o++],s=n.slice(o,o+c).toString(),o+=c,i=n[o++],r=n.slice(o,o+i).toString(),t.abrupt("return",[s,r]);case 17:throw t.prev=17,t.t0=t.catch(7),new Error("Unexpected result from device, parsing error: ".concat(t.t0));case 20:return t.prev=20,this._unlock(),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[1,,20,23],[7,17]])})));return function(){return t.apply(this,arguments)}}()},{key:"getAppConfig",value:function(){var t=Object(c.a)(a.a.mark((function t(){var n,s,r,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._lock(),t.prev=1,t.next=4,this.transport.send(224,h.GET_APP_CONFIG_COMMAND,0,0,e(0),this.allowedStatuses);case 4:if(n=t.sent,this.isSuccess(n)||this.mapProtocolError(n),6===(n=n.slice(0,n.length-2)).length){t.next=9;break}throw new Error("Can't parse app config of length ".concat(n.length));case 9:return s=n.readUInt32BE(0,4),r=n[4],o=n[5],t.abrupt("return",{storage_size:s,keyboard_type:r,press_enter_after_typing:o});case 13:return t.prev=13,this._unlock(),t.finish(13);case 16:case"end":return t.stop()}}),t,this,[[1,,13,16]])})));return function(){return t.apply(this,arguments)}}()},{key:"dump_metadatas",value:function(){var t=Object(c.a)(a.a.mark((function t(){var n,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._lock(),t.prev=1,n=e.alloc(0);case 3:if(!(n.length<this.storage_size)){t.next=13;break}return t.next=6,this.transport.send(224,h.DUMP_METADATAS_COMMAND,0,0,e(0),this.allowedStatuses);case 6:if(s=t.sent,this.isSuccess(s)||this.mapProtocolError(s),n=e.concat([n,e.from(s.slice(1,-2))]),!(255===s[0]&&n.length<this.storage_size)){t.next=11;break}throw new Error("".concat(this.storage_size," bytes requested but only ").concat(n.length," bytes available"));case 11:t.next=3;break;case 13:return t.abrupt("return",this._toJSON(n));case 14:return t.prev=14,this._unlock(),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[1,,14,17]])})));return function(){return t.apply(this,arguments)}}()},{key:"load_metadatas",value:function(){var e=Object(c.a)(a.a.mark((function e(t){var n,s,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._lock(),e.prev=1,0!==(n=this._toBytes(t)).length){e.next=5;break}throw new Error("No data to load");case 5:s=0;case 6:if(!(s<n.length)){e.next=13;break}return r=n.slice(s,s+255),e.next=10,this._load_metadatas_chunk(r,s+r.length===n.length);case 10:s+=255,e.next=6;break;case 13:return e.prev=13,this._unlock(),e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[1,,13,16]])})));return function(t){return e.apply(this,arguments)}}()}]),t}();t.a=p}).call(this,n(23).Buffer)},60:function(e){e.exports=JSON.parse('{"name":"passwords-backup","version":"0.1.0","private":true,"homepage":"https://ledgerhq.github.io/passwords-backup","dependencies":{"@ledgerhq/hw-transport-webusb":"^5.28.0","install":"^0.13.0","react":"^17.0.1","react-accessible-accordion":"^3.3.3","react-dom":"^17.0.1","react-markdown":"^5.0.2","react-toastify":"^6.0.9","web-vitals":"^0.2.4"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@testing-library/jest-dom":"^5.11.4","@testing-library/react":"^11.1.0","@testing-library/user-event":"^12.1.10","gh-pages":"^3.1.0","react-scripts":"4.0.0","prettier":"^2.1.2"}}')},68:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){}},[[154,1,2]]]);
//# sourceMappingURL=main.d5d878f1.chunk.js.map